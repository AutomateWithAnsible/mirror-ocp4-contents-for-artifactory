Role Name
=========

A utility role to mirror OpenShift Container Platform 4.x (OCP4) content for disconnected install.
This only covers the Artifactory use case as this registry does not seem to follow the prescribed API resource layout for container registry v2. 
For instance the bundle generated by Code Sparta  (https://github.com/CodeSparta/openshift) does not work and we cannot use the oc adm release mirror command but the oc image mirror works. This will contains various tasks to mirror all types of contents (images and manifests, operators and manifests). 

Requirements
------------

Any pre-requisites that may not be covered by Ansible itself or the role should be mentioned here. For instance, if the role uses the EC2 module, it may be a good idea to mention in this section that the boto package is required.

Role Variables
--------------

For the bundle tasks:
ansible_name_module: The name of the module this role is part of. This is used to track context when this role is run in a playbook as part of other plays.
dir_bundle_location: Location of the bundle on the host the role/playbook is run against.
bundle_file_name: Name of the xz format compressed artifact bundle file (e.g. artifactory-bundle.tar.xz)
ocp_registry_pull_secret_file: Json formatted pull secret to access the required registries .
ocp_release_image_registry: FQDN of the source registry content will be mirrored from (e.g. redhat.io)
ocp_release_image_repository: Name of the repository being mirrored (e.g. openshift-release-dev/ocp-release)
ocp_release_version: Release version being mirrored (e.g. 4.6.4)
ocp_release_arch: Release architecture for the images being mirrored (e.g. x86_64)

For the unbundle tasks:
ansible_name_module: The name of the module this role is part of. This is used to track context when this role is run in a playbook as part of other plays.
bundle_file_location: Fully qualified location of the xz format compressed bundle on the controller or host the role/playbook is run against.
dir_bundle_staging: Name of the staging diretory the compressed bundle will be uncompressed in and used for the container registry if needed.
registry_admin_username: Username to use to authenticate to the Artifactory destination registry.
registry_admin_password: Password to use to authenticate to the Artifactory destination registry.
registry_host_fqdn: FQDN of the Artofactory registry. Note that this should not have the port associated withthe registry.
local_repository: Name of the local repository mirrored images are pushed into (e.g. openshift4)
release_image_repository: Name of the sub repository mirrored images are pushed into (e.g. openshift-release-dev)



Dependencies
------------

A list of other roles hosted on Galaxy should go here, plus any details in regards to parameters that may need to be set for other roles, or variables that are used from other roles.

Example Playbook
----------------
To create the bundle for Artifactory use the sample play below:

    - hosts: localhost
      tasks:
         - name: Create bundle for artifactory
           import_role:
             name: mirror-ocp4-content-for-artifactory
             tasks_from: bundle-ocp-images.yml
             
To push the bundle content into the Artifactory registry use the sample play below:

    - hosts: localhost
      tasks:
         - name: Push bundle content into artifactory
           import_role:
             name: mirror-ocp4-content-for-artifactory
             tasks_from: unbundle-ocp-images.yml
             

License
-------

BSD

Author Information
------------------

An optional section for the role authors to include contact information, or a website (HTML is not allowed).
